<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.geomhwein.go.securlty.service.NormalUserMapper">

    <insert id="signUp" statementType="CALLABLE">
        CALL InsertUserDetails(
            #{userId},
            #{userPwHash},
            #{userNm},
            'testemail@naver.com',
            'ROLE_NORMALUSER'
            )
    </insert>

    <!-- 결과 매핑 정의 -->
    <resultMap id="UserAuthResultMap" type="com.geomhwein.go.command.UserAuthVO">
        <id property="userId" column="USER_ID" />
        <result property="userNm" column="USER_NM" />
        <result property="userPwHash" column="USER_PW_HASH" />

        <!-- 중첩된 객체 맵핑 -->
        <association property="userDetailsVO" javaType="com.geomhwein.go.command.UserDetailsVO">
            <result property="userEmailAddr" column="USER_EML_ADDR" />
            <result property="userRole" column="USER_ROLE" />
            <!-- 필요한 경우 추가 필드 맵핑 -->
        </association>
    </resultMap>

    <!-- 로그인 쿼리 -->
    <select id="signIn" resultMap="UserAuthResultMap">
        SELECT ua.USER_ID,
               ua.USER_NM,
               ua.USER_PW_HASH,
               ud.USER_EML_ADDR,
               ud.USER_ROLE
        FROM USER_AUTH ua
                 JOIN USER_DETAILS ud ON ua.USER_ID = ud.USER_ID
        WHERE ua.USER_ID = #{userId}
    </select>

</mapper>